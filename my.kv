
<WelcomeScreen>:
    name: "welcomescreen"
    BoxLayout:
        orientation: "vertical"
        spacing: 20
        padding: 50

        canvas.before:
            Color:
                rgba: 0,0,0,0   
            Rectangle:
                pos: self.pos
                size: self.size
            
        Image:
            source: "assets/logo2.png"
            size_hint: (1, 0.7)
            allow_stretch: True
            keep_ratio: True
        Button:
            text: "Start"
            font_size: 24
            size_hint: (0.5, 0.2)
            pos_hint: {"center_x": 0.5}
            on_release:
                app.root.current = "mainmenuscreen" 

<ImageChoosingScreen>:
    name: "melodyscreen"
    BoxLayout:
        orientation: "vertical"
        Image:
            id: img
            size_hint_y: 0.7
            allow_stretch: True
            keep_ratio: True
        BoxLayout:
            size_hint_y: 0.15
            
            Button:
                text: "Import image"
                on_release: root.open_filechooser()
            Button:
                text: "Start"
                on_release: 
                    app.root.current = "melodysettings"
                    app.root.get_screen("melodysettings").selected_file = root.selected_file
                    
        

        Label:
            id: status
            size_hint_y: 0.1
            text: " "

<MainMenuScreen>:
    name:"mainmenuscreen"
    BoxLayout:
        orientation: "vertical"
        Button:
            text: "Melody"
            on_release: 
                app.root.current = "melodyscreen"
        Button:
            text: "Game"
            on_release: 
                app.root.current = "melodyscreen"

<MelodySettingsScreen>:
    name: "melodysettings"
    BoxLayout:
        orientation: "vertical"
        spacing: 20
        padding: 50

        Label:
            text: "–ùMelody settings"
            font_size: 24
            size_hint_y: None
            height: 40
            halign: "center"
            valign: "middle"

        Label:
            text: "Choose the number of octaves"
            font_size: 18
            size_hint_y: None
            height: 30
            halign: "center"
            valign: "middle"

        BoxLayout:
            id: octave_selector
            orientation: "horizontal"
            size_hint_y: None
            height: 50
            spacing: 10

            ToggleButton:
                text: "2"
                group: "octaves"
                on_state: root.set_octaves([4,5]) if self.state=="down" else None

            ToggleButton:
                text: "3"
                group: "octaves"
                state: "down"  
                on_state: root.set_octaves([3,4,5]) if self.state=="down" else None

            ToggleButton:
                text: "4"
                group: "octaves"
                on_state: root.set_octaves([3,4,5,6]) if self.state=="down" else None

            ToggleButton:
                text: "5"
                group: "octaves"
                on_state: root.set_octaves([3,4,5,6,7]) if self.state=="down" else None

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 40
            spacing: 10
            Label:
                text: "Include sharps (#)?"
                font_size: 18
            CheckBox:
                on_active: root.toggle_sharps(self, self.active)

        Widget:
            size_hint_y: 1

        Button:
            text: "Continue"
            size_hint_y: None
            height: 50
            on_release: root.start_processing()

<LoadingScreen>:
    name: "loadingscreen"
    BoxLayout:
        orientation: "vertical"
        spacing: 20
        padding: 50
        Label:
            text: "Melody is generating, please wait..."
            font_size: 24
        ProgressBar:
            id: progress
            max: 100
            value: 0  

<ResultScreen>:
    name: "resultscreen"
    BoxLayout:
        orientation: "vertical"
        spacing: 20
        padding: 50
        Label:
            id: status
            text: "Melody is ready"
        BoxLayout:
            size_hint_y: 0.2
            spacing: 20
            Button:
                text: "Save"
                on_release: root.save_melody()
            Button:
                text: "Play"
                on_release: root.start_processing()
        Button:
            text: "Back to Main Menu"
            size_hint_y: 0.2
            on_release: app.root.current = "mainmenuscreen"
            
<PlayingScreen>:
    name: "playingscreen"
    BoxLayout:
        orientation: "vertical"
        padding: 30
        spacing: 20

        Label:
            id: time_label
            text: " "
            font_size: 20
            size_hint_y: None
            height: 40

        ProgressBar:
            id: progress
            max: 100
            value: 0
            size_hint_y: None
            height: 20

        BoxLayout:
            size_hint_y: None
            height: 60
            spacing: 20

            Button:
                id: play_btn
                text: "Play"
                on_release: root.toggle_play_pause()

            Button:
                text: "Return"
                on_release: root.stop_playing()

ScreenManager:
    WelcomeScreen:
    MainMenuScreen:
    ImageChoosingScreen:
    LoadingScreen:
    ResultScreen:
    PlayingScreen:
    MelodySettingsScreen: